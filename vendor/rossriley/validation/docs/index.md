#Sirius\Validation Documentation

Include it in your project
======
```php
require_once('path_to_sirius_validation_folder/autoloader.php');
```

##Classes

1. [Validator](validator.md) - main class used for data validation
2. [Rules classes](rules.md) - validation classes that match values agains single (not simple!) rules
3. [ErrorMessage](error_message.md) - the errors generated by the validators are of this type. The class implementes `__toString()` so they can be echoed.
4. [RuleFactory](rule_factory.md) - class responsible for creating validation rules (instances of [validation rule classes](rules.md)) to be used by [validators](validator.md)
5. [ValueValidator](value_validator.md) - class to be used for validating single values. It is used by the `Validator` class for storing the rules. You can use it to validate single values as well but it is easier to use the [Helper](helper.md) 
6. [Helper](helper.md) - helper class for simple validation operations

##Example

Given an invoice form the Sirius\Validation library will be used like this:

```php
$validator = new \Sirius\Validation\Validator;
$validator->add('date', 'required', array(), 'Field is required');
$validator->add('date', 'date', 'YYYY-mm-dd', 'Field must be a valid date formated as YYYY-mm-dd (eg: 2013-07-12)');
$validator->add('billing_address[line_1]', 'required', null, 'Must provide the billing address');
$validator->add('billing_address[country]', 'required', null, 'Must provide the country of the billing address');
$validator->add('billing_address[country]', 'countryCode', null, 'Country is not valid');
// continue for the billing address

$validator->add('shipping_address[line_1]', '\MyApp\ValidationRules\RequiredIfShippingIsDifferent', null, 'Must provide the shipping address');
$validator->add('shipping_address[country]', '\MyApp\ValidationRules\RequiredIfShippingIsDifferent', null, 'Must select the country for the shipping address');
// \MyApp\ValidationRules\RequiredIfShippingIsDifferent is a custom validator which 
// will ask for the shipping address only if the checkbox 'same as billing address' was not checked

$validator->add('lines', 'minSize', 1, 'The invoice must have at least one line.');
// no need to provide the validation message, there are defaults for that
$validator->add('lines[*][name]', 'required');
// alternative way to write more validation rules in one line
$validator->add('lines[*][quantity]', 'required | number | greaterThan(min=0&inclusive=0)');
// add multiple validation rules
$validator->add('lines[*][price]', array(
    array('required', null, 'Price not provided',
	array('number', null, 'Price must be a number'),
));


$validator->add('recipients[*]', 'email', null, 'This field must be a valid email');

// this is how you execute the validation
$validator->validate($data);

// retrieving the error messages
$validator->getMessages();
$validator->getMessage('lines[0][price]');
$validator->getMessage('recipients[2]');
```


##Why am doing it this way? 

1. Because I want to be able to do the following in my views
```php
<div class="error">
<?php echo $messages['lines[0][price]']; ?>
</div>
```
This may seem counter-productive but remember that your forms' input fields may look like this
```html
<input name="lines[0][price]" value="abc">
```

2. Because, If I am to do server side validation I can receive a JSON
```javascript
{
	"errors": {
		"recipients[0]": "Field must be a valid email",
		"lines[2][price]": "Price must be a number",
	}
}
```
This way I can find the corresponding HTML inputs and show the error
```javascript
$.each(errors, function(message, field) {
	$('[name="' + field + '"]')
		.parents('div.control')
		.addClass('error')
		.append('<div class="error">'+message+'</div>');	
});
```

3. If I am to do client-side validation I want to do the following
```html
<script>
<?php
$clientSideRules = $helperThatCompilesTheClientSideValidation->getValidationRules($validator);
?>
$('#myForm').validate(<?php echo json_encode($clientSideRules))?>);
</script>
```

##Frequently Asked Questions?

1. Does the library supports translation (for error messages)?

I think the error messages should be translated at the moment you build the validation. In the case of forms you need to be able to retrieve the messages translated for client-side validation so the translation will be executed anyway before the validation.

2. Shouldn't you sanitize the data before validating it?

Yes, you should. But it's not the scope of this library. For such purpose I created [Sirius\Filtration](https://github.com/adrianmiu/SiriusFiltration)
